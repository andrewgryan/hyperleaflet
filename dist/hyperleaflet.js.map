{"version":3,"file":"hyperleaflet.js","sources":["../src/Map/tiles.js","../src/Map/events.js","../src/Map/util.js","../src/config.js","../src/hyperleaflet.js","../src/Geometry/utils.js","../src/Geometry/events.js","../src/Geometry/hyperleaflet-geometry-handler.js","../src/Map/index.js","../src/Map/map.js","../src/Geometry/index.js","../src/Geometry/geometry-object-handler.js","../src/Geometry/leaflet-geometry.js"],"sourcesContent":["import { tileLayer } from 'leaflet';\n\nconst tileLayers = {\n  OpenStreetMap: tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n    attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n  }),\n  EsriWorldImagery: tileLayer(\n    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\n    {\n      attribution:\n        'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',\n    },\n  ),\n};\n\nexport function addTileLayer(newTileLayer) {\n  if (tileLayers[newTileLayer.name]) {\n    console.warn(`Tile layer ${newTileLayer.name} already exists. Skipping.`);\n    return;\n  }\n  tileLayers[newTileLayer.name] = newTileLayer.tile;\n}\n\nexport default tileLayers;\n","function createGenericMapEvent(map, eventName) {\n  const bounds = map.getBounds();\n  const min = bounds.getSouthWest();\n  const max = bounds.getNorthEast();\n  const bboxString = bounds.toBBoxString();\n  const event = new CustomEvent(eventName, {\n    detail: { zoom: map.getZoom(), center: map.getCenter(), bbox: { min, max }, bboxString },\n  });\n  return event;\n}\n\nexport default function setMapEvents(map) {\n  map.on('click', (e) => {\n    const event = new CustomEvent('map:click', { detail: { point: e.latlng } });\n    window.dispatchEvent(event);\n  });\n\n  map.whenReady(() => {\n    const event = createGenericMapEvent(map, 'map:load');\n    window.dispatchEvent(event);\n  });\n\n  map.on('zoomend', () => {\n    const event = createGenericMapEvent(map, 'map:zoom');\n    window.dispatchEvent(event);\n  });\n\n  map.on('move', () => {\n    const event = createGenericMapEvent(map, 'map:move');\n    window.dispatchEvent(event);\n  });\n\n  return map;\n}\n\nexport function sendHyperleafletReady(map) {\n  const event = createGenericMapEvent(map, 'hyperleaflet:ready');\n  window.dispatchEvent(event);\n}\n","import { control, TileLayer } from 'leaflet';\nimport tileLayers, { addTileLayer } from './tiles';\n\nexport function createCustomTileLayer(url, { minZoom, maxZoom, tms } = {}) {\n  return new TileLayer(url, { minZoom: minZoom || 0, maxZoom: maxZoom || 18, tms: !!tms });\n}\n\nexport function createTileController(tiles) {\n  return tiles.length ? control.layers(Object.fromEntries(tiles.map(({ name, tile }) => [name, tile]))) : null;\n}\n\nexport function parseTileLayerElement(tileLayerElement) {\n  const { tile, tileUrl, tms, minZoom, maxZoom } = tileLayerElement.dataset;\n  if (tileUrl) {\n    const newTile = createCustomTileLayer(tileUrl, { minZoom, maxZoom, tms: tms === 'true' });\n    addTileLayer({ name: tile, tile: newTile });\n  }\n  const currentTile = tileLayers[tile];\n  if (!currentTile) {\n    // eslint-disable-next-line no-console\n    console.warn(`${tile} is not in: \\n${Object.keys(tileLayers).join('\\n')}`);\n    return null;\n  }\n  currentTile.options.minZoom = minZoom;\n  currentTile.options.maxZoom = maxZoom;\n  return { tile: currentTile, name: tile };\n}\n\nfunction reverseCoordinates(point) {\n  return point.reverse();\n}\n\nexport function safeParsePoint(pointJson, reverse = false) {\n  try {\n    const point = JSON.parse(pointJson);\n    return reverse ? reverseCoordinates(point) : point;\n  } catch (_) {\n    return [0, 0];\n  }\n}\n","const hyperleafletConfig = {\n  reverseOrderAll: false,\n};\nexport default hyperleafletConfig;\n","import createMap from './Map';\n\nconst hyperleaflet = (function hyperleaflet() {\n  const { initMap, observeMap } = createMap();\n\n  document.addEventListener('DOMContentLoaded', () => {\n    initMap();\n    observeMap();\n  });\n})();\n\nexport default hyperleaflet;\n","export default function utils(node) {\n  node.removeAttribute('data-geometry');\n}\n","export function setPointEvents(leafletObject, id) {\n  leafletObject.on('click', (e) => {\n    const event = new CustomEvent('geometry:click', {\n      detail: { clickedPoint: e.latlng, geometry: leafletObject.getLatLng(), rowId: id }\n    });\n    window.dispatchEvent(event);\n  });\n}\n\nexport function setPolyGeometryEvents(leafletObject, id) {\n  leafletObject.on('click', (e) => {\n    const event = new CustomEvent('geometry:click', { detail: { clickedPoint: e.latlng, geometry: leafletObject.getLatLngs(), rowId: id } });\n    window.dispatchEvent(event);\n  });\n}\n","import createLeafletObject from './leaflet-geometry';\n\nfunction addNodeToHyperleaflet(node, map) {\n  const { dataset } = node;\n  const rowId = dataset.id;\n  // eslint-disable-next-line no-underscore-dangle\n  const leafletLayers = Object.values(map._layers);\n\n  if (leafletLayers.find((layer) => layer.hlID === rowId)) {\n    // eslint-disable-next-line no-console\n    console.error(`%c${rowId}`, 'color:red', 'already exists', node);\n    return;\n  }\n\n  const leafletObject = createLeafletObject({ ...dataset });\n  leafletObject.hlID = rowId;\n  leafletObject.addTo(map);\n}\n\nfunction deleteNodeFromHyperleaflet(node, map) {\n  const rowId = node.dataset.id;\n\n  // eslint-disable-next-line no-underscore-dangle\n  const leafletLayers = Object.values(map._layers);\n  const leafletObject = leafletLayers.find((layer) => layer.hlID === rowId);\n  leafletObject?.remove();\n}\n\nexport default function hyperleafletGeometryHandler(map, { addCallback = () => {}, removeCallback = () => {} }) {\n  const addNoteListToHyperleaflet = (nodes) => {\n    nodes.forEach((node) => {\n      addNodeToHyperleaflet(node, map);\n      addCallback(node);\n    });\n  };\n\n  function removeNodeListToHyperleaflet(nodes) {\n    nodes.forEach((node) => {\n      deleteNodeFromHyperleaflet(node, map);\n      removeCallback(node);\n    });\n  }\n\n  return { addNoteListToHyperleaflet, removeNodeListToHyperleaflet };\n}\n\nexport function diffNodesWithMap(mutations, map) {\n  // eslint-disable-next-line no-underscore-dangle\n  const leafletLayers = Object.values(map._layers);\n  const addList = [];\n  const removeList = [];\n\n  function getAddedNodes(nodes) {\n    nodes.forEach((node) => {\n      if (node.nodeType === 1 && node.matches('[data-id]')) {\n        addList.push(node);\n      }\n      if (node.childNodes.length > 0) {\n        getAddedNodes(node.childNodes);\n      }\n    });\n  }\n\n  function getRemovedNodes(nodes) {\n    nodes.forEach((node) => {\n      if (node.nodeType === 1 && node.matches('[data-id]')) {\n        removeList.push(node);\n      }\n      if (node.childNodes.length > 0) {\n        getRemovedNodes(node.childNodes);\n      }\n    });\n  }\n\n  mutations.forEach((mutation) => {\n    if (mutation.type === 'childList') {\n      getAddedNodes(mutation.addedNodes);\n      getRemovedNodes(mutation.removedNodes);\n    }\n  });\n\n  const filteredRemoveList =\n    removeList.filter((node) => !addList.some((addNode) => addNode.dataset.id === node.dataset.id)) ?? [];\n\n  const filteredAddList =\n    addList.filter((node) => !leafletLayers.some((leafletNode) => leafletNode.hlID === node.dataset.id)) ?? [];\n\n  return { addedNodes: filteredAddList, removedNodes: filteredRemoveList };\n}\n","import createHyperleafletMap, { createHyperleafletTiles } from './map';\nimport hyperleafletDataToMap from '../Geometry/index';\nimport { sendHyperleafletReady } from './events';\nimport hyperleafletConfig from '../config';\n\nfunction createMap() {\n  let initialized = false;\n  function initMap() {\n    const mapContainer = document.querySelector('#map');\n    if (mapContainer && !initialized) {\n      initialized = true;\n      const { reverseCoords } = mapContainer.dataset;\n      if (reverseCoords !== undefined) {\n        hyperleafletConfig.reverseCoords = true;\n      }\n\n      const map = createHyperleafletMap(mapContainer);\n\n      const tileLayerElementList = mapContainer.querySelectorAll('[data-tile]');\n      const { defaultHyperleafletTile, tileController } = createHyperleafletTiles(tileLayerElementList);\n\n      if (tileController) {\n        tileController.addTo(map);\n      }\n      defaultHyperleafletTile.addTo(map);\n      hyperleafletDataToMap(map);\n      window.hyperleaflet = { map };\n      sendHyperleafletReady(map);\n    }\n  }\n\n  function observeMap() {\n    const observer = new MutationObserver(() => {\n      const mapElement = document.querySelector('#map');\n      if (mapElement) {\n        initMap();\n      } else if (initialized) {\n        initialized = false;\n        delete window.hyperleaflet;\n      }\n    });\n    observer.observe(document.documentElement, { childList: true, subtree: true });\n  }\n\n  return { initMap, observeMap };\n}\nexport default createMap;\n","import { map } from 'leaflet';\nimport TILE_LAYERS from './tiles';\nimport setMapEvents from './events';\nimport { createTileController, parseTileLayerElement, safeParsePoint } from './util';\nimport hyperleafletConfig from '../config';\n\nexport function getDefaultHyperleafletTile(tileLayerElementList) {\n  const defaultTileLayerElement = tileLayerElementList.find((t) => 'defaultTile' in t.dataset);\n  if (defaultTileLayerElement && defaultTileLayerElement.dataset.tile in TILE_LAYERS) {\n    return TILE_LAYERS[defaultTileLayerElement.dataset.tile];\n  }\n  if (tileLayerElementList.length && tileLayerElementList[0].dataset.tile in TILE_LAYERS) {\n    return TILE_LAYERS[tileLayerElementList[0].dataset.tile];\n  }\n  return TILE_LAYERS.OpenStreetMap;\n}\n\nexport function createHyperleafletTiles(tileLayerElementNodeList) {\n  const tileLayerElementList = Array.from(tileLayerElementNodeList);\n  const hyperleafletTiles = tileLayerElementList.map(parseTileLayerElement).filter(Boolean);\n  const defaultHyperleafletTile = getDefaultHyperleafletTile(tileLayerElementList);\n  const tileController = createTileController(hyperleafletTiles);\n  return {\n    defaultHyperleafletTile,\n    tileController,\n  };\n}\n\nexport default function createHyperleafletMap(mapElement) {\n  const { center, zoom, minZoom, maxZoom } = mapElement.dataset;\n  const { reverseOrderAll } = hyperleafletConfig;\n  const mapView = {\n    center: safeParsePoint(center, reverseOrderAll),\n    zoom: zoom || 1,\n  };\n  const leafletMap = map(mapElement, {\n    center: mapView.center,\n    zoom: mapView.zoom,\n    minZoom: minZoom || 0,\n    maxZoom: maxZoom || 18,\n  });\n  return setMapEvents(leafletMap);\n}\n","import geometryObjectHandler from './geometry-object-handler';\nimport removeGeometryAttributes from './utils';\nimport hyperleafletGeometryHandler, { diffNodesWithMap } from './hyperleaflet-geometry-handler';\n\nfunction hyperleafletDataToMap(map) {\n  const hyperleafletDataSource = document.querySelector('[data-hyperleaflet-source]');\n\n  if (!hyperleafletDataSource) return;\n\n  const geometryDisplay = hyperleafletDataSource.dataset.geometryDisplay || 'none';\n\n  let callbackFunctions = {};\n  if (geometryDisplay === 'json') {\n    const { addToGeometryObject, removeFromGeometryObject } = geometryObjectHandler();\n    callbackFunctions = {\n      addCallback: addToGeometryObject,\n      removeCallback: removeFromGeometryObject,\n    };\n  } else if (geometryDisplay === 'remove') {\n    callbackFunctions = {\n      addCallback: removeGeometryAttributes,\n      removeCallback: () => {},\n    };\n  }\n\n  const { addNoteListToHyperleaflet, removeNodeListToHyperleaflet } = hyperleafletGeometryHandler(\n    map,\n    callbackFunctions,\n  );\n\n  map.whenReady(() => {\n    const nodes = hyperleafletDataSource.querySelectorAll('[data-id]');\n    addNoteListToHyperleaflet(nodes);\n  });\n\n  function callback(mutations) {\n    const { addedNodes, removedNodes } = diffNodesWithMap(mutations, map);\n    addNoteListToHyperleaflet(addedNodes);\n    removeNodeListToHyperleaflet(removedNodes);\n  }\n\n  const observer = new MutationObserver(callback);\n\n  observer.observe(hyperleafletDataSource, {\n    childList: true, // observe direct children\n    subtree: true, // and lower descendants too\n    attributeFilter: ['data-id'],\n  });\n}\n\nexport default hyperleafletDataToMap;\n","export default function geometryObjectHandler(){\n  const geometryObjectElement = document.createElement('script');\n  geometryObjectElement.type = 'application/json';\n  geometryObjectElement.setAttribute('data-testid', 'json');\n  geometryObjectElement.innerText = '{}';\n  document.body.appendChild(geometryObjectElement);\n  \n  const geometryObject = JSON.parse(geometryObjectElement.text);\n  const addToGeometryObject = (node) =>  {\n    const { id, geometry, geometryType } = node.dataset;\n    node.removeAttribute('data-geometry');\n    geometryObject[id] = { type: geometryType, coordinates: JSON.parse(geometry) };\n    geometryObjectElement.text = JSON.stringify(geometryObject, null, 2);\n  }\n  const removeFromGeometryObject = (node) => {\n    const { id } = node.dataset;\n    delete geometryObject[id];\n    geometryObjectElement.text = JSON.stringify(geometryObject, null, 2);\n  }\n  return {addToGeometryObject, removeFromGeometryObject}\n}\n","import { marker, polyline, polygon, GeoJSON } from 'leaflet';\nimport { setPointEvents, setPolyGeometryEvents } from './events';\nimport hyperleafletConfig from '../config';\n\nconst createPointGeometry = (parsedGeometry, options) => {\n  const { reverseOrderAll, reverseOrder } = options;\n  const isLonLat = reverseOrderAll || (reverseOrder !== undefined)\n  const geometry = isLonLat ? [...parsedGeometry].reverse() : parsedGeometry;\n  const leafletGeometry = marker(geometry);\n  if (options.popup) {\n    leafletGeometry.bindPopup(options.popup);\n  }\n  if (options.tooltip) {\n    leafletGeometry.bindTooltip(options.tooltip);\n  }\n  setPointEvents(leafletGeometry, options.id);\n  return leafletGeometry;\n};\n\nconst createLineGeometry = (parsedGeometry, options) => {\n  const { reverseOrderAll, reverseOrder } = options;\n  const isLonLat = reverseOrderAll || (reverseOrder !== undefined)\n  const geometry = isLonLat ? GeoJSON.coordsToLatLngs(parsedGeometry, 0) : parsedGeometry;\n  const leafletGeometry = polyline(geometry);\n  if (options.popup) {\n    leafletGeometry.bindPopup(options.popup);\n  }\n  if (options.tooltip) {\n    leafletGeometry.bindTooltip(options.tooltip);\n  }\n  setPolyGeometryEvents(leafletGeometry, options.id);\n  return leafletGeometry;\n};\n\nconst createPolygonGeometry = (parsedGeometry, options) => {\n  const { reverseOrderAll, reverseOrder } = options;\n  const isLonLat = reverseOrderAll || (reverseOrder !== undefined)\n  const geometry = isLonLat ? GeoJSON.coordsToLatLngs(parsedGeometry, 1) : parsedGeometry;\n  const leafletGeometry = polygon(geometry);\n  if (options.popup) {\n    leafletGeometry.bindPopup(options.popup);\n  }\n  if (options.tooltip) {\n    leafletGeometry.bindTooltip(options.tooltip);\n  }\n  setPolyGeometryEvents(leafletGeometry, options.id);\n  return leafletGeometry;\n};\n\nconst createGeometry = (geometryType) => (parsedGeometry, options) => {\n  switch (geometryType) {\n    case 'Point':\n      return createPointGeometry(parsedGeometry, options);\n    case 'LineString':\n      return createLineGeometry(parsedGeometry, options);\n    case 'Polygon':\n      return createPolygonGeometry(parsedGeometry, options);\n    default:\n      // eslint-disable-next-line no-console\n      console.warn(`${geometryType} is not supported`);\n      return null;\n  }\n};\n\nexport default function createLeafletObject(row) {\n  const { geometry, popup, tooltip, geometryType, id, reverseOrder } = row;\n  const parsedGeometry = JSON.parse(geometry);\n  const {reverseOrderAll} = hyperleafletConfig;\n  const createGeometryFn = createGeometry(geometryType);\n  return createGeometryFn(parsedGeometry, { popup, tooltip, id, reverseOrderAll, reverseOrder });\n}\n"],"names":["tileLayers","OpenStreetMap","tileLayer","attribution","EsriWorldImagery","createGenericMapEvent","map","eventName","bounds","getBounds","min","getSouthWest","max","getNorthEast","bboxString","toBBoxString","detail","zoom","getZoom","center","getCenter","bbox","parseTileLayerElement","tileLayerElement","newTileLayer","_temp","_ref","_tileLayerElement$dat","dataset","tile","tileUrl","minZoom","maxZoom","newTile","TileLayer","tms","name","console","warn","currentTile","options","Object","keys","join","safeParsePoint","pointJson","reverse","point","JSON","parse","reverseCoordinates","_","_createMap","initMap","observeMap","hyperleafletConfig","reverseOrderAll","utils","node","removeAttribute","setPolyGeometryEvents","leafletObject","id","on","e","event","CustomEvent","clickedPoint","latlng","geometry","getLatLngs","rowId","window","dispatchEvent","diffNodesWithMap","mutations","_removeList$filter","_addList$filter","leafletLayers","values","_layers","removeList","getAddedNodes","nodes","forEach","nodeType","matches","addList","push","childNodes","length","getRemovedNodes","mutation","type","addedNodes","removedNodes","filteredRemoveList","filter","some","addNode","leafletNode","hlID","mapContainer","document","querySelector","initialized","undefined","reverseCoords","createHyperleafletMap","mapElement","mapView","leafletMap","whenReady","_createHyperleafletTi","tileLayerElementNodeList","tiles","tileLayerElementList","Array","from","Boolean","defaultHyperleafletTile","getDefaultHyperleafletTile","defaultTileLayerElement","find","t","TILE_LAYERS","tileController","hyperleafletTiles","control","layers","fromEntries","_ref2","createHyperleafletTiles","querySelectorAll","addTo","hyperleafletDataSource","geometryDisplay","callbackFunctions","geometryObjectHandler","geometryObjectElement","createElement","setAttribute","innerText","body","appendChild","geometryObject","text","addToGeometryObject","_node$dataset","geometryType","coordinates","stringify","removeFromGeometryObject","addCallback","removeCallback","_geometryObjectHandle","removeGeometryAttributes","hyperleafletGeometryHandler","_ref$addCallback","_ref$removeCallback","addNoteListToHyperleaflet","layer","error","row","popup","tooltip","reverseOrder","parsedGeometry","_extends","concat","leafletGeometry","marker","bindPopup","bindTooltip","getLatLng","createPointGeometry","GeoJSON","coordsToLatLngs","polyline","createLineGeometry","polygon","createPolygonGeometry","createGeometry","createGeometryFn","addNodeToHyperleaflet","removeNodeListToHyperleaflet","remove","deleteNodeFromHyperleaflet","_hyperleafletGeometry","MutationObserver","_diffNodesWithMap","observe","childList","subtree","attributeFilter","hyperleafletDataToMap","hyperleaflet","sendHyperleafletReady","documentElement","createMap","addEventListener"],"mappings":"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"}