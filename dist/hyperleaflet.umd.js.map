{"version":3,"file":"hyperleaflet.umd.js","sources":["../src/constants.js","../src/hyperleaflet.js","../src/events.js"],"sourcesContent":["import L from 'leaflet';\r\n\r\nconst TILE_LAYERS = {\r\n  OpenStreetMap: L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n    attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\r\n  }),\r\n  EsriWorldImagery: L.tileLayer(\r\n    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\r\n    {\r\n      attribution:\r\n        'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',\r\n    },\r\n  ),\r\n};\r\n\r\nexport default TILE_LAYERS;\r\n","import L from 'leaflet';\nimport { defineExtension } from 'htmx.org';\nimport TILE_LAYERS from './constants';\nimport initEvents, {initPointEvents} from './events';\n\nconst hyperleaflet = (function hyperleaflet() {\n  if (typeof L === 'undefined') {\n    // eslint-disable-next-line no-console\n    console.error('Hyperleaf can not access Leaflet');\n    return undefined;\n  }\n\n  const mapDiv = document.querySelector('#map');\n  const tileLayerDivs = mapDiv.querySelectorAll('[data-tile]');\n\n  const initalMapAttributes = {\n    center: [0, 0],\n    zoom: 1,\n    tile: TILE_LAYERS.OpenStreetMap,\n  };\n\n  const { dataset } = mapDiv;\n\n  const center = dataset?.center.split(',') || initalMapAttributes.center.center;\n  const zoom = dataset?.zoom || initalMapAttributes.zoom;\n  let { tile } = initalMapAttributes;\n\n  const tiles = {};\n\n  tileLayerDivs.forEach((tileLayer) => {\n    const { dataset: tileLayerDataset } = tileLayer;\n    const tileLayerName = tileLayerDataset.tile;\n    if (tileLayerName in TILE_LAYERS) {\n      const currentTile = TILE_LAYERS[tileLayerName];\n      currentTile.options.minZoom = tileLayerDataset.minZoom;\n      currentTile.options.maxZoom = tileLayerDataset.maxZoom;\n      tiles[tileLayerName] = currentTile;\n      if ('default' in tileLayerDataset) {\n        tile = currentTile;\n      }\n    } else {\n      // eslint-disable-next-line no-console\n      console.warn(`${tileLayerName} is not in: \\n${Object.keys(TILE_LAYERS).join('\\n')}`);\n    }\n  });\n\n  const map = L.map(mapDiv).setView(center, zoom);\n\n  initEvents(map);\n\n  if (Object.keys(tiles).length) {\n    L.control.layers(tiles).addTo(map);\n  }\n  tile.addTo(map);\n\n  const leafletObjects = {};\n\n  const proxy = new Proxy(leafletObjects, {\n    set(target, property, value) {\n      const point = L.marker(value.split(',')).addTo(map);\n      initPointEvents(point, property)\n      target[property] = point;\n      return true;\n    },\n    deleteProperty(target, property) {\n      target[property].remove();\n      delete target[property];\n      return true;\n    },\n  });\n\n  const getDifference = (original, current) => {\n    const originalList = Object.keys(original);\n    const newsList = Object.keys(current);\n\n    const adds = newsList.filter((item) => !originalList.includes(item));\n    const deletes = originalList.filter((item) => !newsList.includes(item));\n\n    return { adds, deletes };\n  };\n\n  const processHyperleafTable = (target) => {\n    const rowNodeList = target.querySelectorAll('[data-id]');\n    const rowList = Array.from(rowNodeList);\n    const currentObjects = rowList.reduce((curr, next) => ({ ...curr, [next.dataset.id]: next.dataset.latlng }), {});\n    const difference = getDifference(leafletObjects, currentObjects);\n\n    difference.adds.forEach((row) => {\n      proxy[row] = currentObjects[row];\n    });\n    difference.deletes.forEach((row) => {\n      delete proxy[row];\n    });\n  };\n\n  defineExtension('leaflet', {\n    onEvent: (name) => {\n      if (['htmx:afterProcessNode', 'htmx:afterOnLoad'].includes(name)) {\n        const hyperleafTable = document.querySelector('[hx-ext=leaflet]');\n        processHyperleafTable(hyperleafTable);\n      }\n    },\n  });\n\n  return { map };\n})();\n\nexport default hyperleaflet;\n","export default function initMapEvents(map) {\r\n  map.on('click', (e) => {\r\n    const elem = document.getElementById('map');\r\n    const event = new CustomEvent('mapclick', { detail: { latlng: e.latlng } });\r\n    elem.dispatchEvent(event);\r\n  });\r\n\r\n  map.on('zoomend', () => {\r\n    const elem = document.getElementById('map');\r\n    const event = new CustomEvent('mapzoom', { detail: { zoom: map.getZoom() } });\r\n    elem.dispatchEvent(event);\r\n  });\r\n\r\n  map.on('move', () => {\r\n    const elem = document.getElementById('map');\r\n    const event = new CustomEvent('mapmove', { detail: { bbox: map.getBounds(), center: map.getCenter() } });\r\n    elem.dispatchEvent(event);\r\n  });\r\n}\r\n\r\nexport function initPointEvents(point, id) {\r\n  point.on('click', (e) => {\r\n    const elem = document.getElementById('map');\r\n    const event = new CustomEvent('pointclick', { detail: { latlng: e.latlng, rowId: id } });\r\n    elem.dispatchEvent(event);\r\n  });\r\n}"],"names":["TILE_LAYERS","OpenStreetMap","L","tileLayer","attribution","EsriWorldImagery","mapDiv","document","querySelector","tileLayerDivs","querySelectorAll","initalMapAttributes","center","zoom","tile","dataset","split","forEach","tileLayerDataset","tileLayerName","currentTile","options","minZoom","maxZoom","tiles","console","warn","Object","keys","join","map","setView","on","e","elem","getElementById","event","CustomEvent","detail","latlng","dispatchEvent","getZoom","bbox","getBounds","getCenter","initEvents","length","control","layers","addTo","proxy","Proxy","leafletObjects","set","target","property","value","marker","point","id","rowId","initPointEvents","deleteProperty","remove","defineExtension","onEvent","name","current","originalList","newsList","rowNodeList","currentObjects","difference","includes","Array","from","reduce","curr","next","_extends2","_extends","adds","filter","item","deletes","row","error"],"mappings":"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"}