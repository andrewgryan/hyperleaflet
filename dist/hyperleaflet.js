!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],t):(e||self).hyperleaflet=t(e.leaflet)}(this,function(e){var t={OpenStreetMap:e.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),EsriWorldImagery:e.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"})};function o(o){var n,r,i,a=o.dataset,l=a.tile,d=a.tileUrl,c=a.minZoom,p=a.maxZoom;if(d){var u=new e.TileLayer(d,{minZoom:(i=void 0===(r={minZoom:c,maxZoom:p,tms:"true"===a.tms})?{}:r).minZoom||0,maxZoom:i.maxZoom||18,tms:!!i.tms});t[(n={name:l,tile:u}).name]?console.warn("Tile layer "+n.name+" already exists. Skipping."):t[n.name]=n.tile}var s=t[l];return s?(s.options.minZoom=c,s.options.maxZoom=p,{tile:s,name:l}):(console.warn(l+" is not in: \n"+Object.keys(t).join("\n")),null)}var n=document.createElement("script");n.type="application/json",n.setAttribute("data-testid","debug"),n.innerText="{}",document.body.appendChild(n);var r=JSON.parse(n.text);function i(e){var t=e.dataset,o=t.id,i=t.geometry,a=t.geometryType;e.removeAttribute("data-geometry"),r[o]={type:a,coordinates:JSON.parse(i)},n.text=JSON.stringify(r,null,2)}function a(e){delete r[e.dataset.id],n.text=JSON.stringify(r,null,2)}function l(e){e.removeAttribute("data-geometry")}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},d.apply(this,arguments)}function c(e,t){e.on("click",function(o){var n=new CustomEvent("geometry:click",{detail:{clickedPoint:o.latlng,geometry:e.getLatLngs(),rowId:t}});window.dispatchEvent(n)})}var p,u=new Map;return function(t){var o=document.querySelector("[data-hyperleaflet-source]");if(o){var n=o.dataset.geometryDisplay||"object",r={};"object"===n?r={addCallback:i,removeCallback:a}:"remove"===n&&(r={addCallback:l,removeCallback:function(){}});var p=function(t,o){var n=o.addCallback,r=void 0===n?function(){}:n,i=o.removeCallback,a=void 0===i?function(){}:i;return{addNoteListToHyperleaflet:function(o){o.forEach(function(o){1===o.nodeType&&o.matches("[data-id]")&&(function(t){var o=t.dataset,n=o.id;if(n in u)return console.error("%c"+n,"color:red","already exists",t),[];var r,i,a,l,p,s,m=(i=(r=d({},o)).popup,a=r.tooltip,l=r.geometryType,p=r.id,s=JSON.parse(r.geometry),function(t){return function(o,n){switch(t){case"Point":return function(t,o){var n,r,i=e.marker(t);return o.popup&&i.bindPopup(o.popup),o.tooltip&&i.bindTooltip(o.tooltip),r=o.id,(n=i).on("click",function(e){var t=new CustomEvent("geometry:click",{detail:{clickedPoint:e.latlng,geometry:n.getLatLng(),rowId:r}});window.dispatchEvent(t)}),i}(o,n);case"LineString":return function(t,o){var n=e.GeoJSON.coordsToLatLngs(t,0),r=e.polyline(n);return o.popup&&r.bindPopup(o.popup),o.tooltip&&r.bindTooltip(o.tooltip),c(r,o.id),r}(o,n);case"Polygon":return function(t,o){var n=e.GeoJSON.coordsToLatLngs(t,1),r=e.polygon(n);return o.popup&&r.bindPopup(o.popup),o.tooltip&&r.bindTooltip(o.tooltip),c(r,o.id),r}(o,n);default:return console.warn(t+" is not supported"),null}}}(l)(s,{popup:i,tooltip:a,id:p}));return u.set(n,m),[m]}(o)[0].addTo(t),r(o))})},removeNodeListToHyperleaflet:function(e){e.forEach(function(e){if(1===e.nodeType&&e.matches("[data-id]")){var t=function(e){var t=e.dataset.id,o=u.get(t);return u.delete(t),[o]}(e);t[0].remove(),a(e)}})}}}(t,r),s=p.addNoteListToHyperleaflet,m=p.removeNodeListToHyperleaflet;t.whenReady(function(){var e=o.querySelectorAll("[data-id]");s(e)}),new MutationObserver(function(e){e.forEach(function(e){"childList"===e.type&&(s(e.addedNodes),m(e.removedNodes))})}).observe(o,{childList:!0,subtree:!0,attributeFilter:["data-id"]})}}(p=function(){var n=document.querySelector("#map"),r=function(t){var o,n,r=t.dataset,i=r.center,a=r.zoom,l=r.minZoom,d=r.maxZoom,c={center:null!=(o=null==i?void 0:i.split(","))?o:[0,0],zoom:a||1},p=e.map(t,{center:c.center,zoom:c.zoom,minZoom:l||0,maxZoom:d||18});return(n=p).on("click",function(e){var t=new CustomEvent("map:click",{detail:{point:e.latlng}});window.dispatchEvent(t)}),n.on("zoomend",function(){var e=new CustomEvent("map:zoom",{detail:{zoom:n.getZoom(),center:n.getCenter(),bbox:n.getBounds()}});window.dispatchEvent(e)}),n.on("move",function(){var e=new CustomEvent("map:move",{detail:{zoom:n.getZoom(),center:n.getCenter(),bbox:n.getBounds()}});window.dispatchEvent(e)}),n}(n),i=function(n){var r,i=Array.from(n),a=i.map(o).filter(Boolean),l=function(e){var o=e.find(function(e){return"defaultTile"in e.dataset});return o&&o.dataset.tile in t?t[o.dataset.tile]:e.length&&e[0].dataset.tile in t?t[e[0].dataset.tile]:t.OpenStreetMap}(i);return{defaultHyperleafletTile:l,tileController:(r=a).length?e.control.layers(Object.fromEntries(r.map(function(e){return[e.name,e.tile]}))):null}}(n.querySelectorAll("[data-tile]")),a=i.defaultHyperleafletTile,l=i.tileController;return l&&l.addTo(r),a.addTo(r),r}()),{map:p,addGeoJsonToMap:function(t){e.geoJSON(t).addTo(p)}}});
//# sourceMappingURL=hyperleaflet.js.map
