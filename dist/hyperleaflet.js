var e=require("leaflet"),t=require("htmx.org");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=/*#__PURE__*/n(e);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},r.apply(this,arguments)}var a={OpenStreetMap:o.default.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),EsriWorldImagery:o.default.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"})};function i(e,t){e.on("click",function(e){var n=document.getElementById("map"),o=new CustomEvent("pointclick",{detail:{point:e.latlng,rowId:t}});n.dispatchEvent(o)})}var l=function(){if(void 0!==o.default){var e=document.createElement("script");e.type="application/json",e.innerText="{}",document.body.appendChild(e);var n=document.querySelector("#map"),l=n.querySelectorAll("[data-tile]"),c={center:[0,0],zoom:1,tile:a.OpenStreetMap},d=n.dataset,u=(null==d?void 0:d.center.split(","))||c.center.center,s=(null==d?void 0:d.zoom)||c.zoom,p=c.tile,m={};l.forEach(function(e){var t=e.dataset,n=t.tile;if(n in a){var o=a[n];o.options.minZoom=t.minZoom,o.options.maxZoom=t.maxZoom,m[n]=o,"default"in t&&(p=o)}else console.warn(n+" is not in: \n"+Object.keys(a).join("\n"))});var f=o.default.map(n).setView(u,s);!function(e){e.on("click",function(e){var t=document.getElementById("map"),n=new CustomEvent("mapclick",{detail:{point:e.latlng}});t.dispatchEvent(n)}),e.on("zoomend",function(){var t=document.getElementById("map"),n=new CustomEvent("mapzoom",{detail:{zoom:e.getZoom()}});t.dispatchEvent(n)}),e.on("move",function(){var t=document.getElementById("map"),n=new CustomEvent("mapmove",{detail:{bbox:e.getBounds(),center:e.getCenter()}});t.dispatchEvent(n)})}(f),Object.keys(m).length&&o.default.control.layers(m).addTo(f),p.addTo(f);var v={},y=new Proxy(v,{set:function(e,t,n){var r=function(e){var t=e.popup,n=e.geometryType,r=e.id,a=JSON.parse(e.geometry);switch(n){case"Point":var l=o.default.marker(a);return t&&l.bindPopup(t),i(l,r),l;case"LineString":var c=o.default.GeoJSON.coordsToLatLngs(a,1),d=o.default.polyline(c);return t&&d.bindPopup(t),i(d,r),d;case"Polygon":console.log(a);var u=o.default.GeoJSON.coordsToLatLngs(a,1);console.log(u);var s=o.default.polygon(u);return t&&s.bindPopup(t),i(s,r),s;default:return console.warn(n+" is not supported"),null}}(n);return r?(r.addTo(f),e[t]=r):console.warn("Geometry with "+t+" can not be created"),!0},deleteProperty:function(e,t){return e[t].remove(),delete e[t],!0}});return t.defineExtension("leaflet",{onEvent:function(t){var n,o,a,i,l,c,d,u;["htmx:afterProcessNode","htmx:afterOnLoad"].includes(t)&&(n=document.querySelector("[hx-ext=leaflet]"),l=JSON.parse(e.text),c=n.querySelectorAll("[data-id]"),o=d=Array.from(c).reduce(function(e,t){var n;return r({},e,((n={})[t.dataset.id]=r({},t.dataset),n))},{}),a=Object.keys(v),(u={adds:(i=Object.keys(o)).filter(function(e){return!a.includes(e)}),deletes:a.filter(function(e){return!i.includes(e)})}).adds.forEach(function(e){l[e]=JSON.parse(d[e].geometry),y[e]=d[e]}),u.deletes.forEach(function(e){delete l[e],delete y[e]}),c.forEach(function(e){e.removeAttribute("data-geometry")}),e.text=JSON.stringify(l,null,2))}}),new MutationObserver(function(e){console.log(e)}).observe(document.querySelector("[hx-ext=leaflet]"),{childList:!0,subtree:!0,characterDataOldValue:!0}),{map:f}}console.error("Hyperleaf can not access Leaflet")}();module.exports=l;
//# sourceMappingURL=hyperleaflet.js.map
