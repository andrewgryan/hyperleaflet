import e from"leaflet";import{defineExtension as t}from"htmx.org";function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},o.apply(this,arguments)}var n={OpenStreetMap:e.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),EsriWorldImagery:e.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"})};function r(e,t){e.on("click",function(e){var o=document.getElementById("map"),n=new CustomEvent("pointclick",{detail:{point:e.latlng,rowId:t}});o.dispatchEvent(n)})}var a=function(){if(void 0!==e){var a=document.createElement("script");a.type="application/json",a.innerText="{}",document.body.appendChild(a);var i=document.querySelector("#map"),c=i.querySelectorAll("[data-tile]"),l={center:[0,0],zoom:1,tile:n.OpenStreetMap},s=i.dataset,d=(null==s?void 0:s.center.split(","))||l.center.center,u=(null==s?void 0:s.zoom)||l.zoom,p=l.tile,m={};c.forEach(function(e){var t=e.dataset,o=t.tile;if(o in n){var r=n[o];r.options.minZoom=t.minZoom,r.options.maxZoom=t.maxZoom,m[o]=r,"default"in t&&(p=r)}else console.warn(o+" is not in: \n"+Object.keys(n).join("\n"))});var f=e.map(i).setView(d,u);!function(e){e.on("click",function(e){var t=document.getElementById("map"),o=new CustomEvent("mapclick",{detail:{point:e.latlng}});t.dispatchEvent(o)}),e.on("zoomend",function(){var t=document.getElementById("map"),o=new CustomEvent("mapzoom",{detail:{zoom:e.getZoom()}});t.dispatchEvent(o)}),e.on("move",function(){var t=document.getElementById("map"),o=new CustomEvent("mapmove",{detail:{bbox:e.getBounds(),center:e.getCenter()}});t.dispatchEvent(o)})}(f),Object.keys(m).length&&e.control.layers(m).addTo(f),p.addTo(f);var v={},y=new Proxy(v,{set:function(t,o,n){var a=function(t){var o=t.popup,n=t.geometryType,a=t.id,i=JSON.parse(t.geometry);switch(n){case"Point":var c=e.marker(i);return o&&c.bindPopup(o),r(c,a),c;case"LineString":var l=e.GeoJSON.coordsToLatLngs(i,1),s=e.polyline(l);return o&&s.bindPopup(o),r(s,a),s;case"Polygon":console.log(i);var d=e.GeoJSON.coordsToLatLngs(i,1);console.log(d);var u=e.polygon(d);return o&&u.bindPopup(o),r(u,a),u;default:return console.warn(n+" is not supported"),null}}(n);return a?(a.addTo(f),t[o]=a):console.warn("Geometry with "+o+" can not be created"),!0},deleteProperty:function(e,t){return e[t].remove(),delete e[t],!0}});return t("leaflet",{onEvent:function(e){var t,n,r,i,c,l,s,d;["htmx:afterProcessNode","htmx:afterOnLoad"].includes(e)&&(t=document.querySelector("[hx-ext=leaflet]"),c=JSON.parse(a.text),l=t.querySelectorAll("[data-id]"),n=s=Array.from(l).reduce(function(e,t){var n;return o({},e,((n={})[t.dataset.id]=o({},t.dataset),n))},{}),r=Object.keys(v),(d={adds:(i=Object.keys(n)).filter(function(e){return!r.includes(e)}),deletes:r.filter(function(e){return!i.includes(e)})}).adds.forEach(function(e){c[e]=JSON.parse(s[e].geometry),y[e]=s[e]}),d.deletes.forEach(function(e){delete c[e],delete y[e]}),l.forEach(function(e){e.removeAttribute("data-geometry")}),a.text=JSON.stringify(c,null,2))}}),new MutationObserver(function(e){console.log(e)}).observe(document.querySelector("[hx-ext=leaflet]"),{childList:!0,subtree:!0,characterDataOldValue:!0}),{map:f}}console.error("Hyperleaf can not access Leaflet")}();export{a as default};
//# sourceMappingURL=hyperleaflet.module.js.map
