!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("leaflet"),require("htmx.org")):"function"==typeof define&&define.amd?define(["leaflet","htmx.org"],t):(e||self).hyperleaflet=t(e.leaflet,e.htmx)}(this,function(e,t){function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=/*#__PURE__*/n(e);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},r.apply(this,arguments)}var a={OpenStreetMap:o.default.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),EsriWorldImagery:o.default.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"})};function i(e,t){e.on("click",function(e){var n=document.getElementById("map"),o=new CustomEvent("pointclick",{detail:{point:e.latlng,rowId:t}});n.dispatchEvent(o)})}return function(){if(void 0!==o.default){var e=document.createElement("script");e.type="application/json",e.innerText="{}",document.body.appendChild(e);var n=document.querySelector("#map"),l=n.querySelectorAll("[data-tile]"),c={center:[0,0],zoom:1,tile:a.OpenStreetMap},d=n.dataset,u=(null==d?void 0:d.center.split(","))||c.center.center,s=(null==d?void 0:d.zoom)||c.zoom,p=c.tile,f={};l.forEach(function(e){var t=e.dataset,n=t.tile;if(n in a){var o=a[n];o.options.minZoom=t.minZoom,o.options.maxZoom=t.maxZoom,f[n]=o,"default"in t&&(p=o)}else console.warn(n+" is not in: \n"+Object.keys(a).join("\n"))});var m=o.default.map(n).setView(u,s);!function(e){e.on("click",function(e){var t=document.getElementById("map"),n=new CustomEvent("mapclick",{detail:{point:e.latlng}});t.dispatchEvent(n)}),e.on("zoomend",function(){var t=document.getElementById("map"),n=new CustomEvent("mapzoom",{detail:{zoom:e.getZoom()}});t.dispatchEvent(n)}),e.on("move",function(){var t=document.getElementById("map"),n=new CustomEvent("mapmove",{detail:{bbox:e.getBounds(),center:e.getCenter()}});t.dispatchEvent(n)})}(m),Object.keys(f).length&&o.default.control.layers(f).addTo(m),p.addTo(m);var y={},v=new Proxy(y,{set:function(e,t,n){var r=function(e){var t=e.popup,n=e.geometryType,r=e.id,a=JSON.parse(e.geometry);switch(n){case"Point":var l=o.default.marker(a);return t&&l.bindPopup(t),i(l,r),l;case"LineString":var c=o.default.GeoJSON.coordsToLatLngs(a,1),d=o.default.polyline(c);return t&&d.bindPopup(t),i(d,r),d;case"Polygon":console.log(a);var u=o.default.GeoJSON.coordsToLatLngs(a,1);console.log(u);var s=o.default.polygon(u);return t&&s.bindPopup(t),i(s,r),s;default:return console.warn(n+" is not supported"),null}}(n);return r?(r.addTo(m),e[t]=r):console.warn("Geometry with "+t+" can not be created"),!0},deleteProperty:function(e,t){return e[t].remove(),delete e[t],!0}});return t.defineExtension("leaflet",{onEvent:function(t){["htmx:afterProcessNode","htmx:afterOnLoad"].includes(t)&&function(t){var n=JSON.parse(e.text),o=t.querySelectorAll("[data-id]"),a=Array.from(o);console.log(new Set(a));var i,l,c,d=a.reduce(function(e,t){var n;return r({},e,((n={})[t.dataset.id]=r({},t.dataset),n))},{}),u=(i=d,l=Object.keys(y),{adds:(c=Object.keys(i)).filter(function(e){return!l.includes(e)}),deletes:l.filter(function(e){return!c.includes(e)})});u.adds.forEach(function(e){n[e]=JSON.parse(d[e].geometry),v[e]=d[e]}),u.deletes.forEach(function(e){delete n[e],delete v[e]}),o.forEach(function(e){e.removeAttribute("data-geometry")}),e.text=JSON.stringify(n,null,2)}(document.querySelector("[hx-ext=leaflet]"))}}),{map:m}}console.error("Hyperleaf can not access Leaflet")}()});
//# sourceMappingURL=hyperleaflet.umd.js.map
