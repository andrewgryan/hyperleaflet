{"version":3,"file":"hyperleaflet.module.js","sources":["../../../src/constants.js","../../../src/hyperleaflet.js"],"sourcesContent":["import L from \"leaflet\";\r\n\r\nconst TILE_LAYERS = {\r\n    OpenStreetMap: L.tileLayer(\"https://tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n        attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\r\n    }),\r\n    EsriWorldImagery: L.tileLayer(\r\n        \"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\",\r\n        {\r\n            attribution:\r\n                \"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\",\r\n        }\r\n    ),\r\n};\r\n\r\nexport default TILE_LAYERS","import L from \"leaflet\";\nimport { defineExtension, remove } from 'htmx.org';\nimport TILE_LAYERS from \"./constants\"\n\nconst hyperleaflet = (function hyperleaflet() {\n    if (typeof L === \"undefined\") {\n        console.error(\"Can't access Leaflet\");\n        return undefined;\n    }\n\n\n\n    const mapDiv = document.querySelector(\"#map\");\n    const tileLayerDivs = mapDiv.querySelectorAll(\"[data-tile]\");\n\n    const initalMapAttributes = {\n        center: [0, 0],\n        zoom: 1,\n        tile: TILE_LAYERS.OpenStreetMap,\n    };\n\n    const { dataset } = mapDiv\n\n    const center = dataset?.center.split(\",\") || initalMapAttributes.center.center;\n    const zoom = dataset?.zoom || initalMapAttributes.zoom;\n    let { tile } = initalMapAttributes\n\n    const tiles = {};\n\n\n    tileLayerDivs.forEach((tileLayer) => {\n        const { dataset: tileLayerDataset } = tileLayer\n        const tileLayerName = tileLayerDataset.tile;\n        if (tileLayerName in TILE_LAYERS) {\n            const tempTile = TILE_LAYERS[tileLayerName];\n            tempTile.options.minZoom = tileLayerDataset.minZoom;\n            tempTile.options.maxZoom = tileLayerDataset.maxZoom;\n            tiles[tileLayerName] = tempTile;\n            if (\"default\" in tileLayerDataset) {\n                tile = tempTile;\n            }\n        } else {\n            console.warn(`${tileLayerName} is not in: \\n${Object.keys(TILE_LAYERS).join(\"\\n\")}`);\n        }\n    });\n\n    const map = L.map(mapDiv).setView(center, zoom);\n\n    if (Object.keys(tiles).length) {\n        L.control.layers(tiles).addTo(map);\n    }\n    tile.addTo(map);\n\n\n\n\n    const leafletObjects = {}\n    const proxy = new Proxy(leafletObjects, {\n        set(target, property, value) {\n            const point = L.marker(value.split(\",\")).addTo(map)\n            target[property] = point;\n            return true;\n        },\n        deleteProperty(target, property) {\n            target[property].remove()\n            delete target[property]\n            return true;\n        }\n    });\n\n    const diff = (original, news) => {\n        const originalList = Object.keys(original)\n        const newsList = Object.keys(news)\n        \n        const adds = newsList.filter(item => !originalList.includes(item))\n        const deletes = originalList.filter(item => !newsList.includes(item))\n\n        return { adds, deletes }\n    }\n\n    const toLeaflet = (target) => {\n        const rowNodeList = target.querySelectorAll(\"[data-id]\")\n        const rowList = Array.from(rowNodeList)\n        const rowsObj = rowList.reduce((curr, next) => ({ ...curr, [next.dataset.id]: next.dataset.latlng }), {})\n        const difference = diff(leafletObjects, rowsObj)\n        difference.adds.forEach(row => { proxy[row] = rowsObj[row] })\n        difference.deletes.forEach(row => { delete proxy[row] })\n\n    }\n\n\n    defineExtension('leaflet', {\n        onEvent: (name) => {\n            if (['htmx:afterProcessNode', 'htmx:afterOnLoad'].includes(name)) {\n                const hyperleafTable = document.querySelector('[hx-ext=leaflet]')\n                toLeaflet(hyperleafTable)\n            }\n        }\n    })\n\n    return { map };\n})();\n\nexport default hyperleaflet;\n"],"names":["TILE_LAYERS","OpenStreetMap","L","tileLayer","attribution","EsriWorldImagery","hyperleaflet","mapDiv","document","querySelector","tileLayerDivs","querySelectorAll","initalMapAttributes","center","zoom","tile","dataset","split","tiles","forEach","tileLayerDataset","tileLayerName","tempTile","options","minZoom","maxZoom","console","warn","Object","keys","join","map","setView","length","control","layers","addTo","leafletObjects","proxy","Proxy","set","target","property","value","point","marker","deleteProperty","remove","defineExtension","onEvent","name","news","originalList","rowNodeList","rowsObj","includes","Array","from","reduce","curr","next","id","latlng","_extends2","adds","filter","item","deletes","newsList","row","difference","error"],"mappings":"sSAEA,IAAMA,EAAc,CAChBC,cAAeC,EAAEC,UAAU,iDAAkD,CACzEC,YAAa,8EAEjBC,iBAAkBH,EAAEC,UAChB,gGACA,CACIC,YACI,mJCNEE,EAAI,WAClB,QAAiB,IAANJ,EAAX,CAOA,IAAMK,EAASC,SAASC,cAAc,QAChCC,EAAgBH,EAAOI,iBAAiB,eAExCC,EAAsB,CACxBC,OAAQ,CAAC,EAAG,GACZC,KAAM,EACNC,KAAMf,EAAYC,eAGPe,EAAKT,EAAZS,WAEc,MAAPA,OAAO,EAAPA,EAASH,OAAOI,MAAM,OAAQL,EAAoBC,OAAOA,OAClEC,GAAc,MAAPE,OAAO,EAAPA,EAASF,OAAQF,EAAoBE,KAC5CC,EAASH,EAATG,KAEAG,EAAQ,CAAA,EAGdR,EAAcS,QAAQ,SAAChB,GACnB,IAAiCiB,EAAKjB,EAA9Ba,QACWK,EAAGD,EAAiBL,KACvC,GAAIM,OAA8B,CAC9B,IAAMC,EAAWtB,EAAYqB,GAC7BC,EAASC,QAAQC,QAAUJ,EAAiBI,QAC5CF,EAASC,QAAQE,QAAUL,EAAiBK,QAC5CP,EAAMG,GAAiBC,EACnB,YAA6BF,IAC7BL,EAAOO,EAEf,MACII,QAAQC,KAAQN,EAA8BO,iBAAAA,OAAOC,KAAK7B,GAAa8B,KAAK,MAEpF,GAEA,IAAMC,EAAM7B,EAAE6B,IAAIxB,GAAQyB,QAAQnB,EAAQC,GAEtCc,OAAOC,KAAKX,GAAOe,QACnB/B,EAAEgC,QAAQC,OAAOjB,GAAOkB,MAAML,GAElChB,EAAKqB,MAAML,GAKX,IAAoBM,EAAG,CAAA,EACjBC,EAAQ,IAAIC,MAAMF,EAAgB,CACpCG,IAAIC,SAAAA,EAAQC,EAAUC,GAClB,IAAWC,EAAG1C,EAAE2C,OAAOF,EAAM1B,MAAM,MAAMmB,MAAML,GAE/C,OADAU,EAAOC,GAAYE,GAEvB,CAAA,EACAE,wBAAeL,EAAQC,GAGnB,OAFAD,EAAOC,GAAUK,gBACJN,EAACC,IACP,CACX,IAiCJ,OATAM,EAAgB,UAAW,CACvBC,QAAS,SAACC,GAEF,IAxBYC,EACdC,IAUWC,EAEXC,IAUE,CAAC,wBAAyB,oBAAoBC,SAASL,KAZ9CG,EAac7C,SAASC,cAAc,oBAb3BE,iBAAiB,aAXxBwC,EAadG,EADUE,MAAMC,KAAKJ,GACHK,OAAO,SAACC,EAAMC,GAAeD,IAAAA,EAAAA,OAAAA,EAAAA,CAAAA,EAAAA,UAAOC,EAAK5C,QAAQ6C,IAAKD,EAAK5C,QAAQ8C,OAASC,GAAA,EAAE,CAAE,GAZlGX,EAAexB,OAAOC,KAaJQ,MAPjB,CAAE2B,QALQpC,OAAOC,KAAKsB,IAEPc,OAAO,SAAAC,GAAI,OAAKd,EAAaG,SAASW,EAAK,GAGlDC,QAFCf,EAAaa,OAAO,SAAAC,GAAI,OAAKE,EAASb,SAASW,EAAK,KAUzDF,KAAK7C,QAAQ,SAAAkD,GAAS/B,EAAM+B,GAAOf,EAAQe,EAAK,GAC3DC,EAAWH,QAAQhD,QAAQ,SAAAkD,UAAqB/B,EAAC+B,EAAK,GAWtD,IAGG,CAAEtC,IAAAA,EA5FT,CAFIL,QAAQ6C,MAAM,uBA+FtB,CAjGsB"}